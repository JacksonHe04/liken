# 项目重构迁移方案

## 1. 架构概览

### 1.1 现有架构
[✓] 前端：Vue3 + Vite
[✓] 后端：Django + Gradio
[✓] 核心功能：大模型交互、多模态处理、知识图谱、算法和Agent

### 1.2 目标架构
[ ] 前端：Next.js + TypeScript + React（替代Vue3 + Vite，实现服务端渲染）
[ ] 后端：Python微服务 + Next.js API Routes（替代Django + Gradio，实现功能解耦）
[ ] 部署：Vercel（前端） + 独立部署的Python微服务
[ ] 数据持久化：MongoDB（文档型数据库，用于存储对话历史、用户数据等）

## 2. 微服务拆分

### 2.1 核心微服务
微服务架构将原有的Django后端拆分为多个独立的Python服务，每个服务都可以独立部署和扩展：

1. **LLM服务**
   [ ] 路径：`/client/*`
   [ ] 功能：大模型API调用和管理
   [ ] 接口：RESTful API
   [ ] 部署：独立容器，需要GPU支持

2. **多模态处理服务**
   [ ] 路径：`/audio/*`
   [ ] 功能：语音识别、文本转语音
   [ ] 接口：RESTful API
   [ ] 部署：独立容器

3. **知识图谱服务**
   [ ] 路径：`/kg/*`
   [ ] 功能：图谱查询和管理
   [ ] 接口：RESTful API
   [ ] 部署：独立容器，需要Neo4j数据库

4. **文档处理服务**
   [ ] 路径：`/ppt_docx/*`
   [ ] 功能：PPT和Word文档生成
   [ ] 接口：RESTful API
   [ ] 部署：独立容器

5. **QA服务**
   [ ] 路径：`/qa/*`
   [ ] 功能：问答系统和功能工具
   [ ] 接口：RESTful API
   [ ] 部署：独立容器

### 2.2 通用功能

1. **配置管理**
   [ ] 路径：`/config/*`
   [ ] 迁移方案：使用环境变量和Next.js配置

2. **环境管理**
   [ ] 路径：`/env.py`
   [ ] 迁移方案：使用.env.local和Next.js环境变量

## 3. 前端重构

### 3.1 技术栈
[ ] Next.js 14+ (App Router) - 替代Vite，提供服务端渲染和API Routes
[ ] TypeScript - 类型安全和开发体验
[ ] TailwindCSS - 原子化CSS框架
[ ] React Query - 服务端状态管理，提供数据缓存、自动重试、乐观更新等特性
[ ] Shad/cn UI - 高质量React组件库

### 3.2 核心组件

1. **聊天界面**
   [ ] 替代现有Gradio UI
   [ ] 实时消息更新
   [ ] 支持多模态输入

2. **文档处理**
   [ ] 文件上传组件
   [ ] 预览组件
   [ ] 进度显示

3. **语音交互**
   [ ] 录音组件
   [ ] 语音播放组件
   [ ] 实时转写显示

### 3.3 API集成

1. **API Routes**
   [ ] `/api/chat`：聊天接口
   [ ] `/api/audio`：语音处理
   [ ] `/api/documents`：文档处理
   [ ] `/api/kg`：知识图谱查询

2. **数据获取**
   [ ] 使用React Query管理服务端状态
   [ ] 实现乐观更新
   [ ] 处理错误边界

## 4. 部署策略

### 4.1 前端部署
[ ] 使用Vercel进行自动部署（仅部署Next.js前端代码）
[ ] 配置环境变量
[ ] 设置自定义域名

### 4.2 后端部署
[ ] 将Python微服务容器化（每个服务独立部署）
[ ] 使用Docker Compose管理服务
[ ] 配置反向代理
[ ] 部署在独立服务器或云服务上（不在Vercel上部署Python服务）

## 5. 迁移步骤

1. 搭建Next.js项目框架
2. 实现核心UI组件
3. 逐个迁移并测试微服务
4. 配置API Routes
5. 进行集成测试
6. 部署和监控

## 6. 注意事项

1. 保持现有功能的完整性
2. 确保API的向后兼容
3. 添加完善的错误处理
4. 实现合适的缓存策略
5. 优化性能和用户体验